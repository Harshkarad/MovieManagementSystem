<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieFlix - Register</title>
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/register.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="register-container">
        <div class="register-card">
            <div class="register-header">
                <img src="/images/logo.png" alt="MovieFlix Logo" class="logo">
                <h1>Join MovieFlix Today</h1>
                <p>Create your account to book tickets for the latest movies</p>
                <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
                <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
            </div>

            <form id="registrationForm" th:object="${user}" onsubmit="handleFormSubmit(event)">

                <!-- Dynamic Error/Success Messages -->
                <div class="alert-container">
                    <div class="alert alert-error"></div>
                    <div class="alert alert-success"></div>
                </div>

                <!-- Name Fields -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="firstName" th:field="*{firstname}" name="firstName"
                                placeholder="John" required>
                        </div>
                        <small class="error-message"></small>
                    </div>

                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="lastName" th:field="*{lastname}" name="lastName" placeholder="Doe"
                                required>
                        </div>
                        <small class="error-message"></small>
                    </div>
                </div>

                <!-- Email Field with OTP Verification -->
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="email" th:field="*{email}" name="email" placeholder="john@example.com"
                            required>
                        <button type="button" id="sendOtpBtn" class="btn-send-otp"
                            style="display: none;">Verify</button>
                    </div>
                    <small class="error-message"></small>
                </div>

                <!-- OTP Verification Section -->
                <div id="otpVerificationSection" style="display: none;">
                    <div class="form-group">
                        <label for="otp">Enter OTP</label>
                        <div class="input-with-icon">
                            <i class="fas fa-key"></i>
                            <input type="text" id="otp" name="otp" placeholder="Enter 6-digit OTP" maxlength="6">
                            <button type="button" id="verifyOtpBtn" class="btn-verify-otp">Verify OTP</button>
                        </div>
                        <small class="error-message" id="otpError"></small>
                    </div>
                </div>

                <!-- Phone Field -->
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <div class="input-with-icon">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="phone" th:field="*{mobile}" inputmode="numeric" name="phone"
                            pattern="[6-9][0-9]{9}" maxlength="10" placeholder="1234567890" required
                            oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);">
                    </div>
                    <small class="error-message" id="phoneError">Please enter a valid 10-digit mobile number starting
                        with 6-9</small>
                </div>

                <!-- Location Field -->
                <div class="form-group">
                    <label for="location">Location (City)</label>
                    <div class="input-with-icon">
                        <i class="fas fa-map-marker-alt"></i>
                        <input type="text" id="location" th:field="*{location}" name="location" placeholder="New York"
                            required>
                    </div>
                    <small class="error-message"></small>
                </div>

                <div class="form-group">
                    <label for="image">Image URL</label>
                    <div class="input-with-icon">
                        <i class="fas fa-map-marker-alt"></i>
                        <input type="text" id="image" th:field="*{profileUrl}" name="image" placeholder="Image URL"
                            required>
                    </div>
                    <small class="error-message"></small>
                </div>

                <!-- Password Field with Strength Meter -->
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" th:field="*{password}" name="password"
                            placeholder="********" required>
                        <span class="toggle-password" data-target="password"><i class="fas fa-eye"></i></span>
                    </div>
                    <div class="password-strength-meter">
                        <div class="strength-bar"></div>
                    </div>
                    <small class="error-message"></small>
                </div>

                <!-- Confirm Password Field -->
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="••••••••"
                            required>
                        <span class="toggle-password" data-target="confirmPassword"><i class="fas fa-eye"></i></span>
                    </div>
                    <small class="error-message"></small>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="registerBtn" class="btn-register">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                        style="display: none;"></span>
                    Create Account
                </button>
            </form>

            <div class="login-link">
                Already have an account? <a th:href="@{/}">Sign In</a>
            </div>
        </div>
    </div>

    <!-- Terms Modal -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Terms and Conditions</h2>
            <div class="modal-body">
                <!-- Content loaded dynamically via JS -->
            </div>
        </div>
    </div>

    <script src="/js/form-validator.js"></script>
    <script src="/js/register.js"></script>
</body>

</html>