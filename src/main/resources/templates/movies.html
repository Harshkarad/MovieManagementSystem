<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies List - Movie Ticket System</title>
    <!-- <link rel="stylesheet" href="/css/movies.css"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<style>
    :root {
        --sidebar-width: 220px;
        --mobile-sidebar-width: 280px;
    }

    /* Base Styles */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f8f9fa;
        overflow-x: hidden;
    }

    .container {
        display: grid;
        grid-template-areas:
            "header header"
            "sidebar content";
        grid-template-columns: var(--sidebar-width) 1fr;
        min-height: 100vh;
    }

    /* Header Styles */
    header {
        grid-area: header;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background-color: #fff;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    h1 {
        font-size: 1.5rem;
        color: #e63946;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .user-controls {
        display: flex;
        gap: 10px;
    }

    button {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    button:hover {
        opacity: 0.9;
    }

    #loginBtn {
        background-color: #457b9d;
        color: white;
    }

    #registerBtn {
        background-color: #1d3557;
        color: white;
    }

    #profileBtn {
        background-color: #457b9d;
        color: white;
    }

    #logoutBtn {
        background-color: #e63946;
        color: white;
    }

    .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #e63946;
    }

    /* Sidebar Container */
    .sidebar {
        grid-area: sidebar;
        background-color: #1a1a2e;
        color: white;
        height: 100vh;
        position: sticky;
        top: 0;
        padding: 1rem 0;
        box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        width: var(--sidebar-width);
    }

    /* Menu List */
    .sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    /* Menu Items */
    .sidebar li {
        margin: 0.25rem 0;
        position: relative;
    }

    /* Menu Links */
    .sidebar a {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1.5rem;
        color: #e2e8f0;
        text-decoration: none;
        font-size: 0.95rem;
        font-weight: 500;
        transition: all 0.2s ease;
        border-left: 4px solid transparent;
    }

    /* Hover State */
    .sidebar a:hover {
        background-color: #16213e;
        color: white;
        border-left-color: #f43f5e;
    }

    /* Active State */
    .sidebar li.active a {
        background-color: #16213e;
        color: white;
        border-left-color: #f43f5e;
    }

    /* Icons */
    .sidebar i {
        width: 1.5rem;
        font-size: 1.1rem;
        text-align: center;
        color: #94a3b8;
    }

    .sidebar li.active i,
    .sidebar a:hover i {
        color: white;
    }

    /* Content Styles */
    .content {
        grid-area: content;
        padding: 20px;
        background-color: #f5f7fa;
        min-height: calc(100vh - 70px);
    }

    /* Mobile Sidebar */
    .mobile-sidebar {
        position: fixed;
        top: 0;
        width: var(--mobile-sidebar-width);
        left: calc(-1 * var(--mobile-sidebar-width));
        height: 100vh;
        background-color: #1a1a2e;
        z-index: 1000;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow-y: auto;
        box-shadow: 5px 0 15px rgba(0, 0, 0, 0.2);
    }

    .mobile-sidebar.show {
        left: 0;
    }

    .mobile-sidebar-header {
        padding: 20px;
        background-color: #16213e;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #2a3f54;
    }

    .mobile-sidebar-header h3 {
        color: white;
        margin: 0;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .mobile-sidebar-header .close-sidebar {
        background: none;
        border: none;
        color: #f43f5e;
        font-size: 1.5rem;
        cursor: pointer;
    }

    .mobile-sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .mobile-sidebar li {
        margin: 0;
    }

    .mobile-sidebar a {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 16px 25px;
        color: #e2e8f0;
        text-decoration: none;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
    }

    .mobile-sidebar a:hover {
        background-color: #16213e;
        color: white;
        border-left-color: #f43f5e;
    }

    .mobile-sidebar li.active a {
        background-color: #16213e;
        color: white;
        border-left-color: #f43f5e;
    }

    .mobile-sidebar i {
        width: 24px;
        font-size: 1.1rem;
        text-align: center;
    }

    .mobile-sidebar li.active i,
    .mobile-sidebar a:hover i {
        color: white;
    }

    .mobile-sidebar-footer {
        padding: 20px;
        text-align: center;
        color: #94a3b8;
        font-size: 0.8rem;
        border-top: 1px solid #2a3f54;
        margin-top: 20px;
    }

    /* Overlay Styles */
    .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 999;
        backdrop-filter: blur(3px);
        transition: all 0.3s ease;
    }

    .sidebar-overlay.active {
        display: block;
    }

    /* Sidebar Scrollbar Styling */
    .mobile-sidebar::-webkit-scrollbar {
        width: 6px;
    }

    .mobile-sidebar::-webkit-scrollbar-track {
        background: #16213e;
    }

    .mobile-sidebar::-webkit-scrollbar-thumb {
        background-color: #f43f5e;
        border-radius: 3px;
    }

    /* Animation for sidebar items */
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .mobile-sidebar.show li {
        animation: slideIn 0.3s ease-out forwards;
    }

    .mobile-sidebar.show li:nth-child(1) {
        animation-delay: 0.1s;
    }

    .mobile-sidebar.show li:nth-child(2) {
        animation-delay: 0.15s;
    }

    .mobile-sidebar.show li:nth-child(3) {
        animation-delay: 0.2s;
    }

    .mobile-sidebar.show li:nth-child(4) {
        animation-delay: 0.25s;
    }

    .mobile-sidebar.show li:nth-child(5) {
        animation-delay: 0.3s;
    }

    .mobile-sidebar.show li:nth-child(6) {
        animation-delay: 0.35s;
    }

    /* Search Bar Styles - Updated for better responsiveness */
    .search-bar {
        display: flex;
        margin-bottom: 20px;
        width: 100%;
        max-width: 100%;
    }

    .search-input-container {
        display: flex;
        width: 100%;
        max-width: 100%;
    }

    .search-input-container input {
        flex: 1;
        min-width: 0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px 0 0 4px;
        font-size: 1rem;
        border-right: none;
    }

    .search-input-container button {
        padding: 0 15px;
        background-color: #e63946;
        color: white;
        border: none;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
        transition: background-color 0.3s;
        min-width: 50px;
    }

    .search-input-container button:hover {
        background-color: #c1121f;
    }

    /* Movies Management Header */
    .movies-header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        gap: 15px;
    }

    .movies-header h2 {
        font-size: 1.5rem;
        color: #333;
        border-bottom: 2px solid #e63946;
        padding-bottom: 5px;
        margin-right: auto;
    }

    .btn-add-movie {
        background-color: #e63946;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
    }

    .btn-show-deactivated {
        background-color: #6c757d;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        white-space: nowrap;
    }

    /* Movies Grid - Updated for better responsiveness */
    .movies-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        width: 100%;
    }

    .movie-card {
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
        display: flex;
        flex-direction: column;
    }

    .movie-card:hover {
        transform: translateY(-5px);
    }

    .movie-poster {
        width: 100%;
        height: 400px;
        object-fit: cover;
        aspect-ratio: 2/3;
    }

    .movie-info {
        padding: 15px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .movie-title {
        font-size: 1.2rem;
        margin-bottom: 10px;
        color: #333;
    }

    .movie-meta {
        display: flex;
        justify-content: space-between;
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 10px;
        flex-wrap: wrap;
        gap: 5px;
    }

    .movie-genre {
        color: #457b9d;
        font-size: 0.9rem;
        margin-bottom: 10px;
        font-weight: 500;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }

    .movie-status {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: 500;
        margin-bottom: 15px;
        align-self: flex-start;
    }

    .status-active {
        background-color: #e6f7ee;
        color: #10b981;
    }

    .status-passive {
        background-color: #fee2e2;
        color: #ef4444;
    }

    .movie-actions {
        display: flex;
        gap: 10px;
        margin-top: auto;
        flex-wrap: wrap;
    }

    .btn-edit {
        background-color: #457b9d;
        color: white;
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        flex: 1;
        min-width: 80px;
        justify-content: center;
    }

    .btn-delete,
    .btn-deactivate,
    .btn-activate {
        background-color: #e63946;
        color: white;
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        flex: 1;
        min-width: 80px;
        justify-content: center;
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border-radius: 8px;
        width: 90%;
        max-width: 800px;
        position: relative;
        max-height: 90vh;
        overflow-y: auto;
    }

    .close {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 1.5rem;
        font-weight: bold;
        color: #aaa;
        cursor: pointer;
    }

    .close:hover {
        color: #333;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }

    .form-group textarea {
        min-height: 100px;
        resize: vertical;
    }

    .form-row {
        display: flex;
        gap: 15px;
    }

    .form-row .form-group {
        flex: 1;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
    }

    .btn-cancel {
        background-color: #94a3b8;
        color: white;
    }

    .btn-submit {
        background-color: #e63946;
        color: white;
    }

    /* Multi-select styles */
    .multi-select-container {
        position: relative;
    }

    .selected-options {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        min-height: 40px;
        align-items: center;
    }

    .selected-options .placeholder {
        color: #999;
    }

    .selected-options .option-tag {
        background-color: #e2e8f0;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .selected-options .option-tag .remove-tag {
        cursor: pointer;
        color: #666;
    }

    .hidden-select {
        display: none;
    }

    .dropdown-arrow {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
    }

    .dropdown-options {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        z-index: 10;
        display: none;
        max-height: 200px;
        overflow-y: auto;
    }

    .dropdown-options.show {
        display: block;
    }

    .dropdown-option {
        padding: 8px 15px;
        cursor: pointer;
    }

    .dropdown-option:hover {
        background-color: #f1f5f9;
    }

    .dropdown-option.selected {
        background-color: #e2e8f0;
    }

    /* Tag input styles */
    .multi-input-container {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
    }

    .input-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }

    .tag {
        background-color: #e2e8f0;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .tag .remove-tag {
        cursor: pointer;
        color: #666;
    }

    .tag-input {
        flex: 1;
        min-width: 100px;
        border: none;
        outline: none;
        padding: 8px;
    }

    /* Image preview */
    .image-preview {
        margin-top: 10px;
        width: 150px;
        height: 225px;
        border: 1px dashed #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .image-preview img {
        max-width: 100%;
        max-height: 100%;
    }

    /* Screening entry styles */
    .screening-entry {
        background-color: #f8fafc;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 10px;
        border: 1px solid #e2e8f0;
    }

    .screening-entry .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
        align-items: flex-end;
    }

    .screening-entry .form-group {
        margin-bottom: 0;
    }

    .btn-remove-screening {
        background-color: #ef4444;
        color: white;
        width: 100%;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        grid-column: 1 / -1;
    }

    .btn-add-screening {
        background-color: #10b981;
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        width: 100%;
        margin-top: 10px;
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
        .movies-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        }
    }

    @media (max-width: 992px) {
        .container {
            grid-template-areas:
                "header"
                "content";
            grid-template-columns: 1fr;
        }

        .sidebar {
            display: none;
        }

        .mobile-menu-toggle {
            display: block;
        }

        .movies-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .header-actions {
            width: 100%;
            justify-content: space-between;
        }

        .btn-add-movie,
        .btn-show-deactivated {
            width: 100%;
            justify-content: center;
        }
    }

    @media (max-width: 768px) {
        .movies-grid {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        }

        .form-row {
            flex-direction: column;
            gap: 0;
        }

        .screening-entry .form-row {
            grid-template-columns: 1fr 1fr;
        }

        .screening-entry .form-group {
            flex: 0 0 calc(50% - 10px);
            margin-bottom: 10px;
        }

        .btn-remove-screening {
            grid-column: span 2;
        }

        .movie-poster {
            height: 350px;
        }
    }

    @media (max-width: 576px) {
        .mobile-sidebar {
            width: 85%;
            left: -85%;
        }

        .mobile-sidebar a {
            padding: 14px 20px;
            font-size: 0.95rem;
        }

        .user-controls button .btn-text {
            display: none;
        }

        .movies-grid {
            grid-template-columns: 1fr;
        }

        .movie-card {
            max-width: 100%;
        }

        .movie-poster {
            height: auto;
            max-height: 500px;
        }

        .search-input-container input {
            font-size: 0.9rem;
        }

        .search-input-container button {
            padding: 0 10px;
        }

        .screening-entry .form-row {
            grid-template-columns: 1fr;
        }

        .btn-remove-screening {
            grid-column: span 1;
        }

        .modal-content {
            width: 95%;
            padding: 15px;
        }
    }

    @media (max-width: 400px) {
        .movie-actions {
            flex-direction: column;
        }

        .btn-edit,
        .btn-delete,
        .btn-deactivate,
        .btn-activate {
            width: 100%;
        }

        .movie-meta {
            flex-direction: column;
            align-items: flex-start;
        }
    }

    /* Header actions for mobile */
    .header-actions {
        display: flex;
        gap: 10px;
        width: 100%;
    }

    .btn-show-deactivated:hover {
        background-color: #5a6268;
    }

    .btn-show-deactivated.active {
        background-color: #343a40;
    }
</style>

<body>
    <div class="container">
        <!-- In the header section, change the button to match the JavaScript selector -->
        <header>
            <button class="mobile-menu-toggle" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <h1><i class="fas fa-ticket-alt"></i> Movie Ticket System</h1>
            <div class="user-controls">
                <div th:if="${session.mobile != null}" style="display: flex; gap: 10px;">
                    
                    <button id="logoutBtn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="btn-text">Logout</span>
                    </button>

                    <script>
                        function logout() {
                            fetch('/logout', {
                                method: 'GET',
                                credentials: 'same-origin' // This ensures cookies/session are included
                            })
                                .then(response => {
                                    if (response.redirected) {
                                        window.location.href = response.url; // Redirect to the home page
                                    }
                                })
                                .catch(error => {
                                    console.error('Logout error:', error);
                                });
                        }
                    </script>
                </div>
            </div>
        </header>

        <nav class="sidebar">
            <ul>
                <li><a href="/admin-home"><i class="fas fa-home"></i> Dashboard</a></li>
                <li class="active"><a href="/movies"><i class="fas fa-film"></i> Movies</a></li>
                <li><a th:href="@{/screenings}"><i class="fas fa-calendar-alt"></i> Screenings</a></li>
                <li><a th:href="@{/customers}"><i class="fas fa-users"></i> Customers</a></li>
                <li><a href="/reports"><i class="fas fa-chart-bar"></i> Reports</a></li>
                <li><a href="/settings"><i class="fas fa-cog"></i> Settings</a></li>
            </ul>
        </nav>

        <!-- Add this mobile sidebar -->
        <div class="mobile-sidebar">
            <div class="mobile-sidebar-header">
                <h3><i class="fas fa-ticket-alt"></i> Movie Ticket System</h3>
                <button class="close-sidebar" aria-label="Close menu">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul>
                <li><a href="/admin-home"><i class="fas fa-home"></i> Dashboard</a></li>
                <li class="active"><a href="/movies"><i class="fas fa-film"></i> Movies</a></li>
                <li><a th:href="@{/screenings}"><i class="fas fa-calendar-alt"></i> Screenings</a></li>
                <li><a th:href="@{/customers}"><i class="fas fa-users"></i> Customers</a></li>
                <li><a href="/reports"><i class="fas fa-chart-bar"></i> Reports</a></li>
                <li><a href="/settings"><i class="fas fa-cog"></i> Settings</a></li>
            </ul>
            <div class="mobile-sidebar-footer">
                &copy; 2023 Movie Ticket System
            </div>
        </div>

        <div class="sidebar-overlay"></div>

        <main class="content">
            <div class="movies-header">
                <h2>Movies Management</h2>
                <button class="btn-add-movie" onclick="openAddMovieModal()">
                    <i class="fas fa-plus"></i> Add Movie
                </button>
                <button class="btn-show-deactivated" onclick="showDeactivatedMovies()">
                    <i class="fas fa-eye-slash"></i> Show Deactivated
                </button>
            </div>

            <div class="search-bar">
                <form id="searchForm" th:action="@{/movies}" method="get">
                    <div class="search-input-container">
                        <input type="text" name="searchQuery" placeholder="Search movies..." th:value="${searchQuery}">
                        <button type="submit"><i class="fas fa-search"></i></button>
                    </div>
                </form>
            </div>

            <div class="movies-grid">
                <div class="movie-card" th:each="movie : ${movieList}">
                    <img th:src="${movie.poster}" alt="Movie Poster" class="movie-poster">
                    <div class="movie-info">
                        <h3 class="movie-title" th:text="${movie.title}">Movie Title</h3>
                        <div class="movie-meta">
                            <span><i class="fas fa-calendar-alt"></i> <span
                                    th:text="${movie.releaseYear}">2023</span></span>
                            <span><i class="fas fa-clock"></i> <span th:text="${movie.duration} + ' min'">120
                                    min</span></span>
                            <span><i class="fas fa-star"></i> <span th:text="${movie.rating}">8.5</span></span>
                        </div>
                        <div class="movie-genre">
                            <span th:each="gen,iterStat : ${movie.genre}"
                                th:text="${gen + (iterStat.last ? '' : ', ')}"></span>
                        </div>
                        <div class="movie-status"
                            th:class="${movie.status == 'ACTIVE' ? 'status-active' : 'status-passive'}"
                            th:text="${movie.status}">Active</div>
                        <div class="movie-actions">
                            <button class="btn-edit"
                                th:onclick="'window.location.href=\'/edit-movie/' + ${movie.id} + '\''">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <form th:action="@{/toggle-movie-status/{id}(id=${movie.id})}" method="post"
                                style="display: inline;">
                                <button type="submit" class="btn-delete"
                                    th:classappend="${movie.status == 'ACTIVE'} ? 'btn-deactivate' : 'btn-activate'"
                                    th:text="${movie.status == 'ACTIVE'} ? 'Deactivate' : 'Activate'">
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Add Movie Modal -->
        <div class="modal" id="addMovieModal">
            <div class="modal-content">
                <span class="close" onclick="closeAddMovieModal()">&times;</span>
                <h2>Add New Movie</h2>
                <form id="addMovieForm" th:object="${movies}" action="/addmovie" method="post">
                    <div class="form-group">
                        <label for="movieTitle">Title*</label>
                        <input type="text" id="movieTitle" th:field="*{title}" required placeholder="Enter movie title">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="movieYear">Release Year*</label>
                            <input type="number" id="movieYear" th:field="*{releaseYear}" min="1900" max="2030" required
                                placeholder="2023">
                        </div>
                        <div class="form-group">
                            <label for="movieDuration">Duration (minutes)*</label>
                            <input type="number" id="movieDuration" th:field="*{duration}" min="1" required
                                placeholder="120">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="movieCertification">Certification*</label>
                            <select id="movieCertification" th:field="*{rating}" required>
                                <option value="">Select certification...</option>
                                <option value="U">U - Universal (Suitable for all)</option>
                                <option value="UA">UA - Parental Guidance (Under 12 with adult)</option>
                                <option value="A">A - Adults only (18+)</option>
                                <option value="S">S - Restricted to special classes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="movieLanguage">Language</label>
                            <input type="text" id="movieLanguage" th:field="*{language}" placeholder="English">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="movieGenre">Genres*</label>
                        <div class="multi-select-container">
                            <div class="selected-options" id="genreSelectedOptions">
                                <span class="placeholder">Select genres...</span>
                            </div>
                            <select id="movieGenre" multiple class="hidden-select" th:field="*{genre}">
                                <option value="Action">Action</option>
                                <option value="Adventure">Adventure</option>
                                <option value="Comedy">Comedy</option>
                                <option value="Drama">Drama</option>
                                <option value="Horror">Horror</option>
                                <option value="Sci-Fi">Sci-Fi</option>
                                <option value="Thriller">Thriller</option>
                                <option value="Romance">Romance</option>
                                <option value="Fantasy">Fantasy</option>
                                <option value="Animation">Animation</option>
                            </select>
                            <div class="dropdown-arrow"><i class="fas fa-chevron-down"></i></div>
                            <div class="dropdown-options" id="genreDropdownOptions"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="movieDirector">Director(s)</label>
                        <div class="multi-input-container">
                            <div class="input-tags" id="directorTags">
                                <input type="text" id="movieDirector" th:field="*{director}" class="tag-input"
                                    placeholder="Add director and press Enter">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="movieCast">Cast</label>
                        <div class="multi-input-container">
                            <div class="input-tags" id="castTags">
                                <input type="text" id="movieCastInput" class="tag-input"
                                    placeholder="Add cast member and press Enter">
                            </div>
                            <input type="hidden" id="movieCast" name="cast"
                                th:value="${#strings.listJoin(movies.cast, ',')}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="movieDescription">Description*</label>
                        <textarea id="movieDescription" th:field="*{description}" required
                            placeholder="Brief summary of the movie"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="movieStatus">Status*</label>
                        <select id="movieStatus" th:field="*{status}" required>
                            <option value="">Select status...</option>
                            <option value="ACTIVE">Active</option>
                            <option value="PASSIVE">Passive</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="moviePoster">Poster URL*</label>
                        <input type="url" id="moviePoster" th:field="*{poster}" required
                            placeholder="https://example.com/poster.jpg">
                        <div class="image-preview" id="posterPreview"></div>
                    </div>

                    <div class="form-group">
                        <label for="movieTrailer">Trailer URL</label>
                        <input type="url" id="movieTrailer" th:field="*{trailer}"
                            placeholder="https://example.com/trailer.mp4">
                    </div>

                    <div class="form-group">
                        <label>Screenings</label>
                        <div id="screeningContainer">
                            <div class="screening-entry">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Date</label>
                                        <input type="date" name="screeningDates" class="screening-date" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Time</label>
                                        <input type="time" name="screeningTimes" class="screening-time" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Screen</label>
                                        <input type="text" name="screens" class="screening-screen"
                                            placeholder="Screen number" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Price</label>
                                        <input type="number" step="0.01" name="prices" class="screening-price"
                                            placeholder="Price" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Seats</label>
                                        <input type="number" name="availableSeats" class="screening-seats"
                                            placeholder="Available seats" required>
                                    </div>
                                    <button type="button" class="btn-remove-screening" onclick="removeScreening(this)">
                                        <i class="fas fa-trash"></i> Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn-add-screening" onclick="addScreening()">Add Another
                            Screening</button>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancel" onclick="closeAddMovieModal()">Cancel</button>
                        <button type="submit" class="btn-submit">Add Movie</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Other modals -->
        <div class="modal" id="loginModal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('loginModal').style.display='none'">&times;</span>
                <h2>Login</h2>
                <form>
                    <input type="text" placeholder="Username" required>
                    <input type="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
            </div>
        </div>

        <div class="modal" id="registerModal">
            <div class="modal-content">
                <span class="close"
                    onclick="document.getElementById('registerModal').style.display='none'">&times;</span>
                <h2>Register</h2>
                <form>
                    <input type="text" placeholder="Full Name" required>
                    <input type="email" placeholder="Email" required>
                    <input type="text" placeholder="Username" required>
                    <input type="password" placeholder="Password" required>
                    <button type="submit">Register</button>
                </form>
            </div>
        </div>
    </div>

    <script src="/js/movies.js"></script>

    <script>
        //     // Function to open add movie modal
        //     function openAddMovieModal() {
        //         document.getElementById('addMovieModal').style.display = 'block';
        //         document.body.classList.add('no-scroll');
        //     }

        //     // Function to close add movie modal
        //     function closeAddMovieModal() {
        //         document.getElementById('addMovieModal').style.display = 'none';
        //         document.body.classList.remove('no-scroll');
        //     }

        //     // Close modals when clicking outside
        //     window.addEventListener('click', function (event) {
        //         if (event.target.className === 'modal') {
        //             event.target.style.display = 'none';
        //             document.body.classList.remove('no-scroll');
        //         }

        //         // Close dropdowns when clicking outside
        //         const dropdowns = document.querySelectorAll('.dropdown-options.show');
        //         dropdowns.forEach(dropdown => {
        //             if (!dropdown.contains(event.target) && !event.target.closest('.multi-select-container')) {
        //                 dropdown.classList.remove('show');
        //             }
        //         });
        //     });

        //     // Login/Register button handlers
        //     document.getElementById('loginBtn').addEventListener('click', function () {
        //         document.getElementById('loginModal').style.display = 'block';
        //         document.body.classList.add('no-scroll');
        //     });

        //     document.getElementById('registerBtn').addEventListener('click', function () {
        //         document.getElementById('registerModal').style.display = 'block';
        //         document.body.classList.add('no-scroll');
        //     });

        //     // With this new version:
        //     document.querySelector('.mobile-menu-toggle').addEventListener('click', function () {
        //         const mobileSidebar = document.querySelector('.mobile-sidebar');
        //         const overlay = document.querySelector('.sidebar-overlay');

        //         mobileSidebar.classList.add('show');
        //         overlay.classList.add('active');
        //         document.body.classList.add('no-scroll');
        //         this.setAttribute('aria-expanded', 'true');
        //     });

        //     // Add this for closing the mobile sidebar:
        //     document.querySelector('.close-sidebar').addEventListener('click', function () {
        //         const mobileSidebar = document.querySelector('.mobile-sidebar');
        //         const overlay = document.querySelector('.sidebar-overlay');

        //         mobileSidebar.classList.remove('show');
        //         overlay.classList.remove('active');
        //         document.body.classList.remove('no-scroll');
        //         document.querySelector('.mobile-menu-toggle').setAttribute('aria-expanded', 'false');
        //     });

        //     // Update the overlay click handler:
        //     document.querySelector('.sidebar-overlay').addEventListener('click', function () {
        //         document.querySelector('.mobile-sidebar').classList.remove('show');
        //         this.classList.remove('active');
        //         document.body.classList.remove('no-scroll');
        //         document.querySelector('.mobile-menu-toggle').setAttribute('aria-expanded', 'false');
        //     });

        //     // Close sidebar when clicking overlay
        //     document.querySelector('.sidebar-overlay').addEventListener('click', function () {
        //         document.querySelector('.sidebar').classList.remove('active');
        //         this.classList.remove('active');
        //         document.body.classList.remove('no-scroll');
        //         document.querySelector('.mobile-menu-toggle').setAttribute('aria-expanded', 'false');
        //     });

        //     // Close sidebar when clicking on a link
        //     document.querySelectorAll('.sidebar a').forEach(link => {
        //         link.addEventListener('click', function () {
        //             document.querySelector('.sidebar').classList.remove('active');
        //             document.querySelector('.sidebar-overlay').classList.remove('active');
        //             document.body.classList.remove('no-scroll');
        //             document.querySelector('.mobile-menu-toggle').setAttribute('aria-expanded', 'false');
        //         });
        //     });

        //     // Initialize when DOM is loaded
        //     document.addEventListener('DOMContentLoaded', function () {
        //         // Add sidebar overlay to DOM
        //         const overlay = document.createElement('div');
        //         overlay.className = 'sidebar-overlay';
        //         document.body.appendChild(overlay);

        //         initializeGenreMultiSelect();
        //         setupTagInputs();
        //         setupPosterPreview();

        //         // Add event listeners to all delete buttons
        //         document.querySelectorAll('.btn-delete').forEach(button => {
        //             button.addEventListener('click', function (e) {
        //                 e.preventDefault();
        //                 if (confirm('Are you sure you want to change the status of this movie?')) {
        //                     showLoading();
        //                     // Submit the form
        //                     this.closest('form').submit();
        //                 }
        //             });
        //         });
        //     });

        //     // Show loading spinner
        //     function showLoading() {
        //         const spinner = document.createElement('div');
        //         spinner.className = 'loading-spinner';
        //         spinner.innerHTML = '<div class="spinner"></div>';
        //         document.body.appendChild(spinner);
        //         spinner.style.display = 'flex';
        //     }

        //     // Genre multi-select functionality
        //     function initializeGenreMultiSelect() {
        //         const genreSelect = document.getElementById('movieGenre');
        //         if (!genreSelect) return;

        //         const genreSelectedOptions = document.getElementById('genreSelectedOptions');
        //         const genreDropdownOptions = document.getElementById('genreDropdownOptions');

        //         // Create dropdown options
        //         Array.from(genreSelect.options).forEach(option => {
        //             const optionItem = document.createElement('div');
        //             optionItem.className = 'option-item';
        //             optionItem.textContent = option.textContent;
        //             optionItem.dataset.value = option.value;

        //             if (option.selected) {
        //                 optionItem.classList.add('selected');
        //             }

        //             optionItem.addEventListener('click', function (e) {
        //                 e.stopPropagation();
        //                 option.selected = !option.selected;
        //                 optionItem.classList.toggle('selected', option.selected);
        //                 updateSelectedGenres();
        //             });

        //             genreDropdownOptions.appendChild(optionItem);
        //         });

        //         function updateSelectedGenres() {
        //             genreSelectedOptions.innerHTML = '';
        //             const selectedOptions = Array.from(genreSelect.selectedOptions);

        //             if (selectedOptions.length === 0) {
        //                 genreSelectedOptions.innerHTML = '<span class="placeholder">Select genres...</span>';
        //                 return;
        //             }

        //             selectedOptions.forEach(option => {
        //                 const tag = document.createElement('div');
        //                 tag.className = 'genre-tag';
        //                 tag.innerHTML = `
        //             ${option.textContent}
        //             <span class="remove-tag" data-value="${option.value}">&times;</span>
        //         `;
        //                 genreSelectedOptions.appendChild(tag);
        //             });

        //             // Add event listeners to remove buttons
        //             document.querySelectorAll('.genre-tag .remove-tag').forEach(btn => {
        //                 btn.addEventListener('click', function (e) {
        //                     e.stopPropagation();
        //                     const value = this.dataset.value;
        //                     const option = Array.from(genreSelect.options).find(opt => opt.value === value);
        //                     if (option) {
        //                         option.selected = false;
        //                         updateSelectedGenres();
        //                         const dropdownOption = Array.from(genreDropdownOptions.children)
        //                             .find(opt => opt.dataset.value === value);
        //                         if (dropdownOption) {
        //                             dropdownOption.classList.remove('selected');
        //                         }
        //                     }
        //                 });
        //             });
        //         }

        //         // Toggle dropdown
        //         document.querySelector('.multi-select-container').addEventListener('click', function (e) {
        //             e.stopPropagation();
        //             genreDropdownOptions.classList.toggle('show');
        //         });

        //         // Initialize
        //         updateSelectedGenres();
        //     }

        //     // Tag inputs for directors and cast
        //     function setupTagInputs() {
        //         setupTagInput('movieDirector', 'directorTags');
        //         setupTagInput('movieCastInput', 'castTags', 'movieCast');
        //     }

        //     function setupTagInput(inputId, tagsContainerId, hiddenInputId = null) {
        //         const container = document.getElementById(tagsContainerId);
        //         if (!container) return;

        //         let input = container.querySelector('.tag-input');
        //         if (!input) {
        //             input = document.createElement('input');
        //             input.type = 'text';
        //             input.className = 'tag-input';
        //             input.placeholder = inputId === 'movieDirector' ?
        //                 'Add director and press Enter' : 'Add cast member and press Enter';
        //             container.appendChild(input);
        //         }

        //         input.addEventListener('keydown', function (e) {
        //             if ((e.key === 'Enter' || e.key === ',') && this.value.trim()) {
        //                 e.preventDefault();
        //                 addTag(this.value.trim(), container, hiddenInputId);
        //                 this.value = '';
        //             } else if (e.key === 'Backspace' && this.value === '') {
        //                 const tags = container.querySelectorAll('.tag');
        //                 if (tags.length > 0) {
        //                     const lastTag = tags[tags.length - 1];
        //                     if (hiddenInputId) {
        //                         updateHiddenInput(hiddenInputId, lastTag.textContent.trim().replace('', ''), true);
        //                     }
        //                     lastTag.remove();
        //                 }
        //             }
        //         });

        //         // Initialize with existing tags if any
        //         const existingTags = container.querySelectorAll('.tag');
        //         existingTags.forEach(tag => {
        //             tag.querySelector('.remove-tag').addEventListener('click', function () {
        //                 if (hiddenInputId) {
        //                     updateHiddenInput(hiddenInputId, tag.textContent.trim().replace('', ''), true);
        //                 }
        //                 tag.remove();
        //             });
        //         });
        //     }

        //     function addTag(value, container, hiddenInputId = null) {
        //         if (!value) return;

        //         const tag = document.createElement('div');
        //         tag.className = 'tag';
        //         tag.innerHTML = `
        //     ${value}
        //     <span class="remove-tag">&times;</span>
        // `;

        //         const removeBtn = tag.querySelector('.remove-tag');
        //         removeBtn.addEventListener('click', function () {
        //             if (hiddenInputId) {
        //                 updateHiddenInput(hiddenInputId, value, true);
        //             }
        //             tag.remove();
        //         });

        //         const input = container.querySelector('.tag-input');
        //         container.insertBefore(tag, input);

        //         if (hiddenInputId) {
        //             updateHiddenInput(hiddenInputId, value);
        //         }
        //     }

        //     function updateHiddenInput(hiddenInputId, value, remove = false) {
        //         const hiddenInput = document.getElementById(hiddenInputId);
        //         if (!hiddenInput) return;

        //         let currentValues = hiddenInput.value ? hiddenInput.value.split(',') : [];

        //         if (remove) {
        //             currentValues = currentValues.filter(v => v.trim() !== value.trim());
        //         } else {
        //             currentValues.push(value.trim());
        //         }

        //         hiddenInput.value = currentValues.join(',');
        //     }

        //     // Poster preview functionality
        //     function setupPosterPreview() {
        //         const posterInput = document.getElementById('moviePoster');
        //         if (!posterInput) return;

        //         const posterPreview = document.getElementById('posterPreview');

        //         posterInput.addEventListener('input', function () {
        //             const url = this.value.trim();
        //             if (url) {
        //                 const img = document.createElement('img');
        //                 img.src = url;
        //                 img.alt = 'Poster Preview';
        //                 img.onerror = function () {
        //                     posterPreview.innerHTML = '<span>Invalid image URL</span>';
        //                 };
        //                 img.onload = function () {
        //                     posterPreview.innerHTML = '';
        //                     posterPreview.appendChild(img);
        //                 };
        //                 posterPreview.innerHTML = 'Loading...';
        //             } else {
        //                 posterPreview.innerHTML = '';
        //             }
        //         });
        //     }

        //     // Screening management
        //     function addScreening() {
        //         const container = document.getElementById('screeningContainer');
        //         const newScreening = document.createElement('div');
        //         newScreening.className = 'screening-entry';
        //         newScreening.innerHTML = `
        //     <div class="form-row">
        //         <div class="form-group">
        //             <label>Date</label>
        //             <input type="date" name="screeningDates" class="screening-date" required>
        //         </div>
        //         <div class="form-group">
        //             <label>Time</label>
        //             <input type="time" name="screeningTimes" class="screening-time" required>
        //         </div>
        //         <div class="form-group">
        //             <label>Screen</label>
        //             <input type="text" name="screens" class="screening-screen" placeholder="Screen number" required>
        //         </div>
        //         <div class="form-group">
        //             <label>Price</label>
        //             <input type="number" step="0.01" name="prices" class="screening-price" placeholder="Price" required>
        //         </div>
        //         <div class="form-group">
        //             <label>Seats</label>
        //             <input type="number" name="availableSeats" class="screening-seats" placeholder="Available seats" required>
        //         </div>
        //         <button type="button" class="btn-remove-screening" onclick="removeScreening(this)"></button>
        //     </div>
        // `;
        //         container.appendChild(newScreening);
        //     }

        //     function removeScreening(button) {
        //         const container = document.getElementById('screeningContainer');
        //         if (container.children.length > 1) {
        //             button.closest('.screening-entry').remove();
        //         } else {
        //             alert("At least one screening is required.");
        //         }
        //     }

        //     // Handle form submission with fetch
        //     document.getElementById('addMovieForm')?.addEventListener('submit', function (e) {
        //         e.preventDefault();
        //         showLoading();

        //         // Submit the form normally (you can replace this with fetch API if needed)
        //         this.submit();
        //     });
        function showDeactivatedMovies() {
            const btn = document.querySelector('.btn-show-deactivated');
            const activeMovies = document.querySelectorAll('.status-active').forEach(card => {
                card.closest('.movie-card').style.display = btn.classList.contains('active') ? 'block' : 'none';
            });
            const inactiveMovies = document.querySelectorAll('.status-passive').forEach(card => {
                card.closest('.movie-card').style.display = btn.classList.contains('active') ? 'none' : 'block';
            });

            btn.classList.toggle('active');
            btn.innerHTML = btn.classList.contains('active') ?
                '<i class="fas fa-eye"></i> Hide Deactivated' :
                '<i class="fas fa-eye-slash"></i> Show Deactivated';
        }
        document.querySelector('#searchForm input[type="text"]').addEventListener('input', function (e) {
            const searchQuery = e.target.value;

            if (searchQuery.length > 2 || searchQuery.length === 0) {
                fetch(`/movies?searchQuery=${encodeURIComponent(searchQuery)}`)
                    .then(response => response.text())
                    .then(html => {
                        // Update only the movies grid part of the page
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        document.querySelector('.movies-grid').innerHTML =
                            doc.querySelector('.movies-grid').innerHTML;
                    });
            }
        });
        // Update the JavaScript to use the correct selector
        document.addEventListener('DOMContentLoaded', function () {
            // Mobile sidebar toggle
            document.getElementById('mobileMenuBtn').addEventListener('click', function () {
                const mobileSidebar = document.querySelector('.mobile-sidebar');
                const overlay = document.querySelector('.sidebar-overlay');

                mobileSidebar.classList.add('show');
                overlay.classList.add('active');
                document.body.classList.add('no-scroll');
            });

            // Close sidebar
            document.querySelector('.close-sidebar').addEventListener('click', function () {
                const mobileSidebar = document.querySelector('.mobile-sidebar');
                const overlay = document.querySelector('.sidebar-overlay');

                mobileSidebar.classList.remove('show');
                overlay.classList.remove('active');
                document.body.classList.remove('no-scroll');
            });

            // Close sidebar when clicking overlay
            document.querySelector('.sidebar-overlay').addEventListener('click', function () {
                const mobileSidebar = document.querySelector('.mobile-sidebar');
                mobileSidebar.classList.remove('show');
                this.classList.remove('active');
                document.body.classList.remove('no-scroll');
            });

            // Rest of your initialization code...
        });

        //</script>
</body>

</html>